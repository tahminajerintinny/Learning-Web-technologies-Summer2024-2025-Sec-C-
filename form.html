<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hydration Tracker</title>
<style>
  body { font-family: Arial; padding: 20px; background: #f0f8ff; }
  nav button { margin-right: 5px; padding: 8px 12px; border: none; background: #2196F3; color: #fff; cursor: pointer; }
  nav button.active { background: #0b63ce; }
  section { display: none; margin-top: 20px; }
  section.active { display: block; }
  input[type=number] { width: 50px; padding: 4px; }
  button.log, button#setGoalBtn, button#setReminderBtn { margin-top: 10px; padding: 8px 15px; background: #2196F3; color: #fff; border: none; cursor: pointer; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  th { background: #2196F3; color: white; }
  #notifWarning { color: red; }
</style>
</head>
<body>

<nav>
  <button id="btnTracker" class="active">Tracker</button>
  <button id="btnReminder">Reminder</button>
  <button id="btnHistory">History</button>
</nav>

<section id="tracker" class="active">
  <h2>Hydration Tracker</h2>
  <label>Daily Goal (glasses):
    <input id="goalInput" type="number" min="1" max="50" value="8" />
  </label>
  <button id="setGoalBtn">Set Goal</button>
  <div><button id="logGlassBtn" class="log">Log a Glass</button></div>
  <p id="progress">0 / 8 glasses logged</p>
</section>

<section id="reminder">
  <h2>Reminder Setup</h2>
  <label>Reminder interval (minutes):
    <input id="reminderInterval" type="number" min="10" max="180" value="60" />
  </label>
  <button id="setReminderBtn">Set Reminder</button>
  <p id="reminderStatus"></p>
  <p id="notifWarning"></p>
</section>

<section id="history">
  <h2>History</h2>
  <table>
    <thead><tr><th>Date</th><th>Glasses Logged</th></tr></thead>
    <tbody id="historyBody"></tbody>
  </table>
</section>

<script>
  const tabs = { btnTracker: 'tracker', btnReminder: 'reminder', btnHistory: 'history' };
  Object.keys(tabs).forEach(id => {
    document.getElementById(id).onclick = () => {
      Object.keys(tabs).forEach(i => document.getElementById(i).classList.remove('active'));
      Object.values(tabs).forEach(s => document.getElementById(s).classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.getElementById(tabs[id]).classList.add('active');
    };
  });

  const goalInput = document.getElementById('goalInput');
  const setGoalBtn = document.getElementById('setGoalBtn');
  const logGlassBtn = document.getElementById('logGlassBtn');
  const progress = document.getElementById('progress');
  const reminderIntervalInput = document.getElementById('reminderInterval');
  const setReminderBtn = document.getElementById('setReminderBtn');
  const reminderStatus = document.getElementById('reminderStatus');
  const notifWarning = document.getElementById('notifWarning');
  const historyBody = document.getElementById('historyBody');

  const STORAGE = { goal: 'waterGoal', logs: 'waterLogs', history: 'waterHistory', reminder: 'waterReminder' };
  let dailyGoal = 8, glassesLogged = 0, reminderInterval = 60, reminderTimer;

  const save = (k, v) => localStorage.setItem(k, v);
  const load = k => localStorage.getItem(k);
  const saveJSON = (k, v) => localStorage.setItem(k, JSON.stringify(v));
  const loadJSON = k => JSON.parse(localStorage.getItem(k)) || {};

  function updateProgress() {
    progress.textContent = `${glassesLogged} / ${dailyGoal} glasses logged`;
  }

  function updateHistory() {
    const history = loadJSON(STORAGE.history);
    historyBody.innerHTML = '';
    const dates = Object.keys(history).sort((a,b) => b.localeCompare(a));
    if (!dates.length) {
      historyBody.innerHTML = '<tr><td colspan="2">No history</td></tr>';
      return;
    }
    dates.forEach(date => {
      historyBody.innerHTML += `<tr><td>${date}</td><td>${history[date]}</td></tr>`;
    });
  }

  logGlassBtn.onclick = () => {
    if (glassesLogged < dailyGoal) {
      glassesLogged++;
      updateProgress();
      save(STORAGE.logs, glassesLogged);
    }
  };

  setGoalBtn.onclick = () => {
    let val = parseInt(goalInput.value);
    if (isNaN(val) || val < 1 || val > 50) return alert('Goal must be 1-50');
    dailyGoal = val;
    glassesLogged = 0;
    updateProgress();
    save(STORAGE.goal, dailyGoal);
    save(STORAGE.logs, glassesLogged);
    alert(`Goal set to ${dailyGoal}`);
  };

  setReminderBtn.onclick = () => {
    let val = parseInt(reminderIntervalInput.value);
    if (isNaN(val) || val < 10 || val > 180) return alert('Interval 10-180 min');
    reminderInterval = val;
    save(STORAGE.reminder, reminderInterval);
    setupReminder();
    alert(`Reminder set every ${reminderInterval} min`);
  };

  function setupReminder() {
    if (reminderTimer) clearInterval(reminderTimer);
    if (!("Notification" in window)) {
      notifWarning.textContent = "Notifications not supported";
      return;
    }
    if (Notification.permission === "default") {
      Notification.requestPermission().then(p => {
        notifWarning.textContent = p === "granted" ? "" : "Please allow notifications";
      });
    }
    reminderTimer = setInterval(() => {
      if (Notification.permission === "granted" && glassesLogged < dailyGoal/2) {
        new Notification("Hydration Reminder", { body: "You're behind on your water intake." });
      }
    }, reminderInterval * 60000);
    reminderStatus.textContent = `Reminder every ${reminderInterval} minutes`;
  }

  window.addEventListener('beforeunload', () => {
    let history = loadJSON(STORAGE.history);
    const today = new Date().toISOString().slice(0,10);
    history[today] = glassesLogged;
    saveJSON(STORAGE.history, history);
  });

  function init() {
    dailyGoal = parseInt(load(STORAGE.goal)) || 8;
    glassesLogged = parseInt(load(STORAGE.logs)) || 0;
    reminderInterval = parseInt(load(STORAGE.reminder)) || 60;
    goalInput.value = dailyGoal;
    reminderIntervalInput.value = reminderInterval;
    updateProgress();
    updateHistory();
    setupReminder();
  }
  init();
</script>

</body>
</html>
